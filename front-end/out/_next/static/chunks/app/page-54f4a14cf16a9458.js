(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3058:function(e,t,n){Promise.resolve().then(n.bind(n,4358))},4358:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var c=n(3827),s=n(4090);function l(e){let{sender:t,text:n}=e;return(0,c.jsxs)("div",{className:"chat-message mb-4",children:[(0,c.jsx)("h4",{className:"chat-author font-bold text-zinc-950",children:t}),(0,c.jsx)("p",{className:"chat-text text-zinc-950",children:n})]})}function o(){let[e,t]=(0,s.useState)([]),[n,l]=(0,s.useState)([]),o={},[a,i]=(0,s.useState)("disconnected"),[d,u]=(0,s.useState)({1:void 0,2:void 0}),f=(0,s.useRef)(null);function x(e,n){(1==+e?t:l)(e=>{if(console.log("@@@ prevMessages",e),e.length>0){let{interactionId:t,text:c}=e[e.length-1];if(t&&t===n.interactionId)return[...e.slice(0,-1),{...n,text:"".concat(c," ").concat(n.text.replace("•","").trim())}]}return[...e,{...n,text:n.text.replace("•","").trim()}]})}let h=e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=d[e];f.current&&f.current.readyState===WebSocket.OPEN&&f.current.send(JSON.stringify({type:t,text:n,CallSid:c})),"hijack-call"===t&&x(e,{sender:"System",text:"Forwarding the call to you..."})};return(0,s.useEffect)(()=>{console.log("ws connecting...");let e=new WebSocket("ws://localhost:8080");return f.current=e,e.onmessage=e=>{let t=JSON.parse(e.data);if("new-msg"===t.type){console.log("@@@ new-msg",t);let e=o[t.CallSid];console.log("@@@ currentCall",e,o);let n=e?e.callId:0;if(!n){console.warn("callId is null");return}x(n,t);return}if("call-started"===t.type){let{CallSid:e,From:n,callId:c}=t;o[e]={CallSid:e,From:n,callId:c},u(t=>({...t,[c]:e})),x(c,{sender:"System",text:"Call started with ".concat(n)});return}if("call-ended"===t.type){let{CallSid:e,From:n,callId:c}=t;o[e]={CallSid:e,From:n,callId:c},u(e=>({...e,[c]:void 0})),x(c,{sender:"System",text:"Call with the Bot has ended."});return}if("front-end-connected"===t.type){i("connected");return}},e.onclose=e=>{console.log("ws closed",e),i("disconnected")},e.onerror=e=>{console.error("Socket error",e),i("disconnected & error")},()=>{f.current&&f.current.close()}},[]),(0,c.jsxs)("div",{className:"flex flex-row h-screen",children:[(0,c.jsx)(r,{messages:e,color:"red",status:a,sendCommandSocket:h("1"),CallSid:d[1]}),(0,c.jsx)(r,{messages:n,color:"blue",status:a,sendCommandSocket:h("2"),CallSid:d[2]})]})}function r(e){let{messages:t,color:n,status:o,sendCommandSocket:r,CallSid:a}=e,[i,d]=(0,s.useState)("connecting...");"connected"!==o||a||(o="waiting for a call...");let u="connected"===o?"":"bg-gray-300",f="connected"!==o;function x(){r("new-msg-from-supervisor",i),d("")}return(0,s.useEffect)(()=>{console.log("status changed",o),"connected"===o?d(""):d(o)},[o]),(0,c.jsxs)("div",{className:"flex-1 flex flex-col justify-between bg-red-400",children:[(0,c.jsx)("div",{id:"chat",className:"p-4 rounded shadow overflow-auto",children:t.map((e,t)=>(0,c.jsx)(l,{...e},t))}),(0,c.jsxs)("div",{id:"textbox",className:"flex justify-end items-center space-x-2 bg-".concat(n,"-500 p-2"),children:[(0,c.jsx)("textarea",{className:"flex-1 ".concat(u),rows:3,value:i,onChange:e=>d(e.target.value),onKeyDown:function(e){"Enter"===e.key&&(x(),e.preventDefault())},disabled:f}),(0,c.jsx)("button",{className:"px-4 py-3 bg-green-500 text-white",onClick:x,children:"Send"}),(0,c.jsx)("button",{className:"px-4 py-3 bg-yellow-500 text-white",onClick:function(){window.parent&&window.parent.postMessage({type:"FLEX_CHANGE_ACTIVITY_TO_AVAILABLE"},"*"),r("hijack-call")},children:"Hijack"})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=3058)}),_N_E=e.O()}]);