(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4822:function(e,t,n){Promise.resolve().then(n.bind(n,4358))},4358:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var o=n(3827),c=n(4090);function s(e){let{sender:t,text:n}=e;return(0,o.jsxs)("div",{className:"chat-message mb-4",children:[(0,o.jsx)("h4",{className:"chat-author font-bold text-zinc-950",children:t}),(0,o.jsx)("p",{className:"chat-text text-zinc-950",children:n})]})}function r(){let[e,t]=(0,c.useState)([]),[n,s]=(0,c.useState)([]),r={},[a,d]=(0,c.useState)("disconnected"),[i,u]=(0,c.useState)({1:void 0,2:void 0}),f=(0,c.useRef)(null);function g(e,n){(1==+e?t:s)(e=>{if(console.log("@@@ prevMessages",e),e.length>0){let{interactionId:t,text:o}=e[e.length-1];if(t&&t===n.interactionId)return[...e.slice(0,-1),{...n,text:"".concat(o," ").concat(n.text.replace("•","").trim())}]}return[...e,{...n,text:n.text.replace("•","").trim()}]})}let h=e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=i[e];f.current&&f.current.readyState===WebSocket.OPEN&&f.current.send(JSON.stringify({type:t,text:n,CallSid:o})),"hijack-call"===t&&g(e,{sender:"System",text:"Forwarding the call to you..."})};return(0,c.useEffect)(()=>{console.log("ws connecting...");let e=new WebSocket("ws://localhost:8080");return f.current=e,e.onmessage=e=>{let t=JSON.parse(e.data);if("new-msg"===t.type){console.log("@@@ new-msg",t);let e=r[t.CallSid];console.log("@@@ currentCall",e,r);let n=e?e.callId:0;if(!n){console.warn("callId is null");return}g(n,t);return}if("call-started"===t.type){let{CallSid:e,From:n,callId:o}=t;r[e]={CallSid:e,From:n,callId:o},u(t=>({...t,[o]:e})),g(o,{sender:"System",text:"Call started with ".concat(n)});return}if("call-ended"===t.type){let{CallSid:e,From:n,callId:o}=t;r[e]={CallSid:e,From:n,callId:o},u(e=>({...e,[o]:void 0})),g(o,{sender:"System",text:"Call with the Bot has ended."});return}if("front-end-connected"===t.type){console.log("@@@ front-end-connected"),d("connected"),h("0")("give-me-all-current-calls");return}},e.onclose=e=>{console.log("ws closed",e),d("disconnected")},e.onerror=e=>{console.error("Socket error",e),d("disconnected & error")},()=>{f.current&&f.current.close()}},[]),(0,o.jsxs)("div",{className:"flex flex-row h-screen",children:[(0,o.jsx)(l,{messages:e,color:"red",status:a,sendCommandSocket:h("1"),CallSid:i[1]}),(0,o.jsx)(l,{messages:n,color:"blue",status:a,sendCommandSocket:h("2"),CallSid:i[2]})]})}function l(e){let{messages:t,color:n,status:r,sendCommandSocket:l,CallSid:a}=e,[d,i]=(0,c.useState)("connecting..."),[u,f]=(0,c.useState)("connecting...");"connected"!==r||a||(r="waiting for a call...");let g="connected"===r?"":"bg-gray-100",h="connected"!==r;function x(){l("new-msg-from-supervisor",d),i("")}return(0,c.useEffect)(()=>{console.log("status changed",r),i(""),"connected"===r?f("Send a hint"):f(r)},[r]),(0,o.jsxs)("div",{className:"flex-1 bg-indigo-100 flex flex-col justify-between p-4 space-y-4",children:[(0,o.jsx)("div",{id:"chat",className:"p-4 rounded shadow overflow-auto bg-indigo-200",children:t.map((e,t)=>(0,o.jsx)(s,{...e},t))}),(0,o.jsxs)("div",{id:"textbox",className:"mt-auto flex justify-end items-center space-x-2 bg-".concat(n,"-600 p-2 rounded-lg"),children:[(0,o.jsx)("textarea",{placeholder:u,className:"flex-1 ".concat(g," rounded-lg"),rows:2,value:d,onChange:e=>i(e.target.value),onKeyDown:function(e){"Enter"===e.key&&(x(),e.preventDefault())},disabled:h}),(0,o.jsx)("button",{className:"px-4 py-2 bg-red-500 text-white rounded shadow-md hover:bg-red-600 transition-colors duration-200",onClick:x,children:"Send"}),(0,o.jsx)("button",{className:"px-4 py-2 bg-green-500 text-white rounded shadow-md hover:bg-green-600 transition-colors duration-200",onClick:function(){window.parent&&window.parent.postMessage({type:"FLEX_CHANGE_ACTIVITY_TO_AVAILABLE"},"*"),l("hijack-call")},children:"Hijack"})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=4822)}),_N_E=e.O()}]);